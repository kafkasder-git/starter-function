const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/BeneficiaryDetailPageComprehensive-DACAwX-v.js","assets/js/react-vendor-Zi_jsHoK.js","assets/js/beneficiaries-page-CkZlrYV8.js","assets/js/utils-vendor-CH-VcvGo.js","assets/js/toast-vendor-Ci27VDWJ.js","assets/js/appwrite-vendor-Ct7vfU_L.js","assets/js/motion-vendor-iBxafAnt.js","assets/js/ui-vendor-f6_gbUtQ.js","assets/js/checkbox-mTcZPd65.js","assets/js/radio-group-D6_ytqLl.js","assets/js/user-management-page-B6-AaFFc.js","assets/js/messaging-page-BEU6nUaR.js","assets/js/events-finance-page-DWyC3OLf.js","assets/js/accordion-DcJeMgHu.js","assets/js/InteractiveChart-DgS3w7qG.js","assets/js/recharts-vendor-CZVoIEH2.js","assets/js/DonationsPage-DqsRG0MI.js","assets/js/PushNotificationManager-BjyUJ3Yv.js","assets/js/switch-C3esbnVh.js","assets/js/tabs-fYszpb1R.js","assets/js/BackgroundSyncManager-BM6Rid19.js"])))=>i.map(i=>d[i]);
function e(){const[e,r]=t.useState("overview"),[u,g]=t.useState("monthly"),[p,S]=t.useState(!0),[O,P]=t.useState(null),{toast:$}=M(),V=e=>{const a=new Date,t=new Date;switch(e){case"weekly":t.setDate(a.getDate()-7);break;case"monthly":default:t.setMonth(a.getMonth()-1);break;case"quarterly":t.setMonth(a.getMonth()-3);break;case"yearly":t.setFullYear(a.getFullYear()-1)}return{start:t,end:a}};return t.useEffect(()=>{(async()=>{try{S(!0);const e=V(u),a=await L.generateDonationAnalytics(e);P(a)}catch(e){$("Bağış analitikleri yüklenirken hata oluştu")}finally{S(!1)}})()},[u,$]),p?a.jsx(y,{title:"Bağış Raporları",subtitle:"Bağış analitikleri ve detaylı raporlar",actions:a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(f,{variant:"outline",disabled:!0,children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"Dışa Aktar"]}),a.jsxs(f,{variant:"outline",disabled:!0,children:[a.jsx(s,{className:"w-4 h-4 mr-2"}),"Yenile"]})]}),children:a.jsx("div",{className:"flex h-64 items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"border-primary mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-b-2"}),a.jsx("p",{className:"text-muted-foreground",children:"Rapor verileri yükleniyor..."})]})})}):a.jsx(y,{title:"Bağış Raporları",subtitle:"Bağış analitikleri ve detaylı raporlar",actions:a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(f,{variant:"outline",onClick:()=>{$("Rapor Excel formatında dışa aktarılıyor...")},children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"Dışa Aktar"]}),a.jsxs(f,{variant:"outline",onClick:()=>{(async()=>{try{S(!0);const e=V(u),a=await L.generateDonationAnalytics(e);P(a)}catch(e){$("Bağış analitikleri yüklenirken hata oluştu")}finally{S(!1)}})()},children:[a.jsx(s,{className:"w-4 h-4 mr-2"}),"Yenile"]})]}),children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs(B.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bağış Analitikleri"}),a.jsx("p",{className:"text-gray-600",children:"Detaylı bağış raporları ve trend analizi"})]}),a.jsx("div",{className:"flex gap-3",children:a.jsxs(w,{value:u,onValueChange:g,children:[a.jsx(x,{className:"w-[180px]",children:a.jsx(b,{placeholder:"Zaman aralığı"})}),a.jsxs(N,{children:[a.jsx(v,{value:"weekly",children:"Son 7 Gün"}),a.jsx(v,{value:"monthly",children:"Son 1 Ay"}),a.jsx(v,{value:"quarterly",children:"Son 3 Ay"}),a.jsx(v,{value:"yearly",children:"Son 1 Yıl"})]})]})})]}),a.jsxs(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[a.jsx(_,{className:"border-0 bg-gradient-to-br from-blue-50 to-blue-100 shadow-lg",children:a.jsx(D,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Toplam Bağış"}),a.jsxs("p",{className:"mt-1 text-2xl font-bold text-blue-900",children:["₺",O?.performance.total_donations.toLocaleString("tr-TR")??"0"]}),a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[a.jsx(i,{className:"h-4 w-4 text-green-500"}),a.jsxs("span",{className:"text-sm font-medium text-green-600",children:["+",O?.performance.growth_rate.toFixed(1)??"0","%"]})]})]}),a.jsx("div",{className:"rounded-lg p-3 bg-blue-200",children:a.jsx(l,{className:"h-6 w-6 text-blue-700"})})]})})}),a.jsx(_,{className:"border-0 bg-gradient-to-br from-green-50 to-green-100 shadow-lg",children:a.jsx(D,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Bağışçı Sayısı"}),a.jsx("p",{className:"mt-1 text-2xl font-bold text-green-900",children:O?.performance.unique_donors.toLocaleString("tr-TR")??"0"}),a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[a.jsx(i,{className:"h-4 w-4 text-green-500"}),a.jsxs("span",{className:"text-sm font-medium text-green-600",children:["+",O?.performance.retention_rate.toFixed(1)??"0","%"]})]})]}),a.jsx("div",{className:"rounded-lg p-3 bg-green-200",children:a.jsx(c,{className:"h-6 w-6 text-green-700"})})]})})}),a.jsx(_,{className:"border-0 bg-gradient-to-br from-purple-50 to-purple-100 shadow-lg",children:a.jsx(D,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Ortalama Bağış"}),a.jsxs("p",{className:"mt-1 text-2xl font-bold text-purple-900",children:["₺",O?.performance.average_donation.toLocaleString("tr-TR")??"0"]}),a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[a.jsx(i,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm font-medium text-green-600",children:"+5.2%"})]})]}),a.jsx("div",{className:"rounded-lg p-3 bg-purple-200",children:a.jsx(o,{className:"h-6 w-6 text-purple-700"})})]})})}),a.jsx(_,{className:"border-0 bg-gradient-to-br from-orange-50 to-orange-100 shadow-lg",children:a.jsx(D,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Büyüme Oranı"}),a.jsxs("p",{className:"mt-1 text-2xl font-bold text-orange-900",children:[O?.performance.growth_rate.toFixed(1)??"0","%"]}),a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[O?.performance.growth_rate&&O.performance.growth_rate>0?a.jsx(i,{className:"h-4 w-4 text-green-500"}):a.jsx(d,{className:"h-4 w-4 text-red-500"}),a.jsxs("span",{className:"text-sm font-medium "+(O?.performance.growth_rate&&O.performance.growth_rate>0?"text-green-600":"text-red-600"),children:[O?.performance.growth_rate&&O.performance.growth_rate>0?"+":"",O?.performance.growth_rate.toFixed(1)??"0","%"]})]})]}),a.jsx("div",{className:"rounded-lg p-3 bg-orange-200",children:a.jsx(m,{className:"h-6 w-6 text-orange-700"})})]})})})]}),a.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:a.jsxs(R,{value:e,onValueChange:r,className:"space-y-6",children:[a.jsxs(E,{className:"grid w-full grid-cols-3 lg:flex lg:w-auto lg:grid-cols-none",children:[a.jsx(A,{value:"overview",children:"Genel Bakış"}),a.jsx(A,{value:"trends",children:"Trendler"}),a.jsx(A,{value:"segmentation",children:"Segmentasyon"})]}),a.jsx(C,{value:"overview",className:"space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[a.jsxs(_,{className:"border-0 bg-white/80 shadow-lg backdrop-blur-sm",children:[a.jsx(k,{children:a.jsxs(T,{className:"flex items-center gap-2",children:[a.jsx(o,{className:"h-5 w-5 text-blue-600"}),"Aylık Bağış Trendleri"]})}),a.jsx(D,{children:a.jsx(I,{height:300,children:a.jsx("div",{className:"flex h-[300px] items-center justify-center rounded-lg bg-gray-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx(o,{className:"mx-auto mb-2 h-12 w-12 text-gray-400"}),a.jsx("p",{className:"text-gray-500",children:"Trend grafiği yükleniyor..."})]})})})})]}),a.jsxs(_,{className:"border-0 bg-white/80 shadow-lg backdrop-blur-sm",children:[a.jsx(k,{children:a.jsxs(T,{className:"flex items-center gap-2",children:[a.jsx(i,{className:"h-5 w-5 text-green-600"}),"Tahminler"]})}),a.jsx(D,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"rounded-lg bg-gradient-to-r from-green-50 to-blue-50 p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Gelecek Ay Tahmini"}),a.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["₺",O?.predictions.next_month_forecast.toLocaleString("tr-TR")??"0"]})]}),a.jsxs(j,{variant:"outline",className:"text-green-600",children:["%",O?.predictions.confidence_interval.toFixed(0)??"0"," ","Güven"]})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"rounded-lg bg-blue-50 p-4 text-center",children:[a.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["₺",O?.predictions.quarterly_forecast.toLocaleString("tr-TR")??"0"]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Çeyreklik Tahmin"})]}),a.jsxs("div",{className:"rounded-lg bg-purple-50 p-4 text-center",children:[a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"up"===O?.predictions.trend_direction?"↗":"down"===O?.predictions.trend_direction?"↘":"→"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Trend Yönü"})]})]})]})})]})]})}),a.jsx(C,{value:"trends",className:"space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[a.jsxs(_,{className:"border-0 bg-white/80 shadow-lg backdrop-blur-sm",children:[a.jsx(k,{children:a.jsx(T,{children:"Mevsimsel Paternler"})}),a.jsx(D,{children:a.jsx(I,{height:400,children:a.jsx("div",{className:"flex h-[400px] items-center justify-center rounded-lg bg-gray-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx(m,{className:"mx-auto mb-2 h-12 w-12 text-gray-400"}),a.jsx("p",{className:"text-gray-500",children:"Mevsimsel analiz yükleniyor..."})]})})})})]}),a.jsxs(_,{className:"border-0 bg-white/80 shadow-lg backdrop-blur-sm",children:[a.jsx(k,{children:a.jsx(T,{children:"Yıllık Karşılaştırma"})}),a.jsx(D,{children:a.jsx("div",{className:"space-y-4",children:(O?.trends.yearly_comparison??[]).map((e,t)=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium text-gray-900",children:[e.year," Yılı"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:[e.count," bağış"]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"font-semibold text-gray-900",children:["₺",e.amount.toLocaleString("tr-TR")]})})]},e.year))})})]})]})}),a.jsx(C,{value:"segmentation",className:"space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[a.jsxs(_,{className:"border-0 bg-white/80 shadow-lg backdrop-blur-sm",children:[a.jsx(k,{children:a.jsxs(T,{className:"flex items-center gap-2",children:[a.jsx(h,{className:"h-5 w-5 text-green-600"}),"Bağışçı Tipi Dağılımı"]})}),a.jsx(D,{children:a.jsx("div",{className:"space-y-4",children:(O?.segmentation.by_donor_type??[]).map((e,t)=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-4 w-4 rounded-full bg-blue-500"}),a.jsx("span",{className:"font-medium text-gray-900 capitalize",children:"individual"===e.type?"Bireysel":"corporate"===e.type?"Kurumsal":"anonymous"===e.type?"Anonim":e.type})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"font-semibold text-gray-900",children:[e.count," kişi"]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["₺",e.total.toLocaleString("tr-TR")]})]})]},e.type))})})]}),a.jsxs(_,{className:"border-0 bg-white/80 shadow-lg backdrop-blur-sm",children:[a.jsx(k,{children:a.jsx(T,{children:"Bağış Tutarı Dağılımı"})}),a.jsx(D,{children:a.jsx("div",{className:"space-y-4",children:(O?.segmentation.by_amount_range??[]).map((e,t)=>a.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[a.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:e.range}),a.jsxs(j,{variant:"outline",children:[e.count," bağış"]})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Toplam:"}),a.jsxs("span",{className:"font-medium",children:["₺",e.total.toLocaleString("tr-TR")]})]}),a.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-gray-200",children:a.jsx("div",{className:"h-2 rounded-full bg-blue-600 transition-all duration-500",style:{width:e.count/Math.max(...(O?.segmentation.by_amount_range??[]).map(e=>e.count))*100+"%"}})})]},e.range))})})]})]})})]})})]})})}import{j as a,r as t,cd as r,a2 as n,ba as s,a1 as i,H as l,$ as c,al as o,am as d,a9 as m,bx as h}from"./react-vendor-Zi_jsHoK.js";import{l as u,h as g,w as p,Y as y,B as f,S as w,j as x,k as b,m as N,n as v,C as _,e as D,a as k,b as T,f as j}from"./beneficiaries-page-CkZlrYV8.js";import{T as R,a as E,b as A,c as C}from"./tabs-fYszpb1R.js";import{u as M}from"./user-management-page-B6-AaFFc.js";import{m as B}from"./motion-vendor-iBxafAnt.js";import"./ui-vendor-f6_gbUtQ.js";import"./utils-vendor-CH-VcvGo.js";import"./toast-vendor-Ci27VDWJ.js";import"./appwrite-vendor-Ct7vfU_L.js";import"./messaging-page-BEU6nUaR.js";import"./events-finance-page-DWyC3OLf.js";const L=new class{cache=new Map;CACHE_TTL=3e5;MAX_CACHE_SIZE=100;async generateReport(e){const a=Date.now(),t=this.getCacheKey("generateReport",e);try{const r=this.getFromCache(t);if(r)return r;const n=await this.fetchReportData(e),s={success:!0,data:await this.processReportData(n,e),metadata:{generatedAt:(new Date).toISOString(),processingTime:Date.now()-a,cacheKey:t}};return this.setCache(t,s),s}catch(r){throw u.error("Report generation failed:",r),new Error(`Report generation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}async generateFinancialReport(e,a){const t=e.start.toISOString(),r=e.end.toISOString();try{const{data:e,error:a}=await g.list("donations",[p.greaterThanEqualDate("created_at",t),p.lessThanEqualDate("created_at",r)]);if(a)throw a;const{data:n,error:s}=await g.list("expenses",[p.greaterThanEqualDate("created_at",t),p.lessThanEqualDate("created_at",r)]);if(s)throw s;const i=e?.documents?.reduce((e,a)=>e+a.amount,0)??0,l=n?.documents?.reduce((e,a)=>e+a.amount,0)??0;return{totalDonations:i,totalExpenses:l,netIncome:i-l,donationsCount:e?.documents?.length??0,expensesCount:n?.documents?.length??0}}catch(n){throw u.error("Financial report generation failed:",n),new Error("Financial report generation failed")}}async generateDonationAnalytics(e,a,t,r){const n=e.start.toISOString(),s=e.end.toISOString();try{const{data:e,error:a}=await g.list("donations",[p.greaterThanEqualDate("created_at",n),p.lessThanEqualDate("created_at",s)]);if(a)throw a;const t=e?.reduce((e,a)=>e+a.amount,0)??0,r=e?.length??0,i=e?.filter(e=>e.is_recurring).length??0,l=r>0?t/r:0,c=[];if(e){const a=e.reduce((e,a)=>{const t=a.donor_type??"unknown";return e[t]||(e[t]={count:0,total:0}),e[t].count++,e[t].total+=a.amount,e},{});Object.entries(a).forEach(([e,a])=>{c.push({type:e,count:a.count,total:a.total,average:a.count>0?a.total/a.count:0})})}return{totalAmount:t,totalCount:r,averageAmount:l,recurringCount:i,donorTypes:c,trends:{monthly_donations:this.aggregateMonthlyData(e??[]),yearly_comparison:this.calculateYearlyComparison(e??[]),seasonal_patterns:this.analyzeSeasonalPatterns(e??[])},segmentation:{by_donor_type:c,by_amount_range:this.segmentByAmountRange(e??[]),by_frequency:this.segmentByFrequency(e??[]),by_campaign:this.segmentByCampaign(e??[])},predictions:{next_month_forecast:this.calculateNextMonthForecast(e??[]),quarterly_forecast:this.calculateQuarterlyForecast(e??[]),confidence_interval:this.calculateConfidenceInterval(e??[]),trend_direction:"stable"},performance:{total_donations:t,unique_donors:r,average_donation:l,retention_rate:this.calculateRetentionRate(e??[]),growth_rate:this.calculateGrowthRate(e??[])}}}catch(i){throw u.error("Donation analytics generation failed:",i),new Error("Donation analytics generation failed")}}async generateImpactReport(e,a){const t=e.start.toISOString(),r=e.end.toISOString();try{const{data:e,error:a}=await g.list("beneficiaries",[p.greaterThanEqualDate("created_at",t),p.lessThanEqualDate("created_at",r)]);if(a)throw a;const n=e?.length??0,s={};return e?.forEach(e=>{const a=e.city??"Unknown";s[a]=(s[a]??0)+1}),{totalBeneficiaries:n,demographics:{by_location:Object.entries(s).map(([e,a])=>({city:e,count:a,percentage:n>0?a/n*100:0})),by_age_group:this.processAgeGroupData(e??[]),by_gender:this.processGenderData(e??[])},services:{education_support:0,healthcare_assistance:0,food_aid:0,financialSupport:0},impact_metrics:{families_helped:n,children_supported:0,elderly_cared_for:0,emergency_cases:0}}}catch(n){throw u.error("Impact report generation failed:",n),new Error("Impact report generation failed")}}async exportReport(e,a="csv",t){try{return await this.generateReport(e),{success:!0,url:`/exports/${t??`report_${Date.now()}.${a}`}`}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Export failed"}}}async fetchReportData(e){const a=e.config.dataSources?.[0]?.source??"default",t=this.extractDateRange(e.config.filters),r={start:new Date(0),end:new Date};switch(a){case"financial":default:return await this.fetchFinancialData(t??r);case"donations":return await this.fetchDonationData(t??r);case"beneficiaries":return await this.fetchImpactData(t??r);case"members":return await this.fetchMemberData(t??r);case"campaigns":return await this.fetchCampaignData(t??r)}}extractDateRange(e){if(!e)return;const a=e?.find(e=>"date_range"===e.field);if(a?.value){const{start:e,end:t}=a.value;return{start:new Date(e),end:new Date(t)}}}async fetchFinancialData(e){const a=e.start.toISOString(),t=e.end.toISOString(),{data:r}=await g.list("donations",[p.greaterThanEqualDate("created_at",a),p.lessThanEqualDate("created_at",t)]),{data:n}=await g.list("expenses",[p.greaterThanEqualDate("created_at",a),p.lessThanEqualDate("created_at",t)]);return{donations:r??[],expenses:n??[]}}async fetchDonationData(e){const a=e.start.toISOString(),t=e.end.toISOString(),{data:r}=await g.list("donations",[p.greaterThanEqualDate("created_at",a),p.lessThanEqualDate("created_at",t)]);return{donations:r??[]}}async fetchImpactData(e){const a=e.start.toISOString(),t=e.end.toISOString(),{data:r}=await g.list("beneficiaries",[p.greaterThanEqualDate("created_at",a),p.lessThanEqualDate("created_at",t)]);return{beneficiaries:r??[]}}async processReportData(e,a){return{summary:{totalRecords:0,dateRange:{start:new Date,end:new Date},lastUpdated:(new Date).toISOString()},metrics:[],trends:[],insights:[]}}getCacheKey(e,a){return`${e}_${JSON.stringify(a)}`}getFromCache(e){const a=this.cache.get(e);return a?Date.now()-a.timestamp>a.ttl?(this.cache.delete(e),null):a.data:null}setCache(e,a){if(this.cache.size>=this.MAX_CACHE_SIZE){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,{data:a,timestamp:Date.now(),ttl:this.CACHE_TTL,key:e})}aggregateMonthlyData(e){const a=new Map;return e.forEach(e=>{if(e.created_at){const t=new Date(e.created_at),r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;a.set(r,(a.get(r)??0)+e.amount)}}),Array.from(a.entries()).map(([e,a])=>({date:e,value:a}))}calculateYearlyComparison(e){const a=new Map;return e.forEach(e=>{if(e.created_at){const t=new Date(e.created_at).getFullYear().toString();a.set(t,(a.get(t)??0)+e.amount)}}),Array.from(a.entries()).map(([e,a])=>({date:e,value:a}))}analyzeSeasonalPatterns(e){const a=new Map;return e.forEach(e=>{if(e.created_at){const t=new Date(e.created_at),r=this.getSeason(t.getMonth());a.set(r,(a.get(r)??0)+e.amount)}}),Array.from(a.entries()).map(([e,a])=>({date:e,value:a}))}getSeason(e){return e>=2&&e<=4?"Spring":e>=5&&e<=7?"Summer":e>=8&&e<=10?"Autumn":"Winter"}segmentByAmountRange(e){return[{min:0,max:100,label:"0-100 TL"},{min:100,max:500,label:"100-500 TL"},{min:500,max:1e3,label:"500-1000 TL"},{min:1e3,max:5e3,label:"1000-5000 TL"},{min:5e3,max:1/0,label:"5000+ TL"}].map(a=>{const t=e.filter(e=>e.amount>=a.min&&e.amount<a.max);return{range:a.label,count:t.length,total:t.reduce((e,a)=>e+a.amount,0)}})}segmentByFrequency(e){const a=e.filter(e=>e.is_recurring),t=e.filter(e=>!e.is_recurring);return[{frequency:"One-time",count:t.length,total:t.reduce((e,a)=>e+a.amount,0)},{frequency:"Recurring",count:a.length,total:a.reduce((e,a)=>e+a.amount,0)}]}segmentByCampaign(e){const a=new Map;return e.forEach(e=>{const t=e.campaign_id?`Campaign ${e.campaign_id}`:"No Campaign",r=a.get(t)??{count:0,total:0};a.set(t,{count:r.count+1,total:r.total+e.amount})}),Array.from(a.entries()).map(([e,a])=>({campaign:e,count:a.count,total:a.total}))}calculateNextMonthForecast(e){const a=this.getLastThreeMonthsData(e),t=a.reduce((e,a)=>e+a,0)/a.length;return Math.round(t)}calculateQuarterlyForecast(e){const a=this.getLastQuarterData(e);return Math.round(a.reduce((e,a)=>e+a,0))}calculateConfidenceInterval(e){const a=e.map(e=>e.amount),t=a.reduce((e,a)=>e+a,0)/a.length,r=a.reduce((e,a)=>e+Math.pow(a-t,2),0)/a.length;return Math.round(1.96*Math.sqrt(r))}analyzeTrendDirection(e){const a=this.getLastThreeMonthsData(e);if(a.length<2)return"stable";const t=a[a.length-1]-a[0];return t>.1?"increasing":t<-.1?"decreasing":"stable"}calculateRetentionRate(e){const a=new Set(e.map(e=>e.donor_email).filter(Boolean)),t=e.filter(e=>e.is_recurring).length;return a.size>0?t/a.size*100:0}calculateGrowthRate(e){const a=this.getCurrentMonthData(e),t=this.getPreviousMonthData(e);if(0===t.length)return 0;const r=a.reduce((e,a)=>e+a.amount,0),n=t.reduce((e,a)=>e+a.amount,0);return n>0?(r-n)/n*100:0}processAgeGroupData(e){const a=new Map;return e.forEach(e=>{const t="Unknown";a.set(t,(a.get(t)??0)+1)}),Array.from(a.entries()).map(([e,a])=>({ageGroup:e,count:a}))}processGenderData(e){const a=new Map;return e.forEach(e=>{const t=e.gender??"Unknown";a.set(t,(a.get(t)??0)+1)}),Array.from(a.entries()).map(([e,a])=>({gender:e,count:a}))}getLastThreeMonthsData(e){const a=new Date,t=new Date(a.getFullYear(),a.getMonth()-3,1);return e.filter(e=>e.created_at&&new Date(e.created_at)>=t).map(e=>e.amount)}getLastQuarterData(e){const a=new Date,t=new Date(a.getFullYear(),3*Math.floor(a.getMonth()/3),1);return e.filter(e=>e.created_at&&new Date(e.created_at)>=t).map(e=>e.amount)}getCurrentMonthData(e){const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1);return e.filter(e=>e.created_at&&new Date(e.created_at)>=t)}getPreviousMonthData(e){const a=new Date,t=new Date(a.getFullYear(),a.getMonth()-1,1),r=new Date(a.getFullYear(),a.getMonth(),0);return e.filter(e=>{if(!e.created_at)return!1;const a=new Date(e.created_at);return a>=t&&a<=r})}async fetchMemberData(e){const a=e.start.toISOString(),t=e.end.toISOString();try{const{data:e,error:r}=await g.list("members",[p.greaterThanEqualDate("created_at",a),p.lessThanEqualDate("created_at",t)]);if(r)throw r;return e}catch(r){throw new Error(`Member data fetch failed: ${r instanceof Error?r.message:"Unknown error"}`)}}async fetchCampaignData(e){const a=e.start.toISOString(),t=e.end.toISOString();try{const{data:e,error:r}=await g.list("campaigns",[p.greaterThanEqualDate("created_at",a),p.lessThanEqualDate("created_at",t)]);if(r)throw r;return e}catch(r){throw new Error(`Campaign data fetch failed: ${r instanceof Error?r.message:"Unknown error"}`)}}};t.lazy(()=>r(()=>import("./BeneficiaryDetailPageComprehensive-DACAwX-v.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(e=>({default:e.BeneficiaryDetailPageComprehensive}))),t.lazy(()=>r(()=>import("./InteractiveChart-DgS3w7qG.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,15])).then(e=>({default:e.InteractiveChart}))),t.lazy(()=>r(()=>import("./user-management-page-B6-AaFFc.js").then(e=>e.U),__vite__mapDeps([10,1,2,3,4,5,6,7,11,12])).then(e=>({default:e.UserManagementPageReal}))),t.lazy(()=>r(()=>import("./DonationsPage-DqsRG0MI.js"),__vite__mapDeps([16,1,2,3,4,5,6,7])).then(e=>({default:e.DonationsPage}))),t.lazy(()=>r(()=>import("./beneficiaries-page-CkZlrYV8.js").then(e=>e.ai),__vite__mapDeps([2,1,7,3,4,5,6])).then(e=>({default:e.BeneficiariesPageEnhanced}))),t.lazy(()=>r(()=>import("./events-finance-page-DWyC3OLf.js").then(e=>e.F),__vite__mapDeps([12,1,2,3,4,5,6,7])).then(e=>({default:e.FinanceIncomePage}))),t.lazy(()=>r(()=>import("./events-finance-page-DWyC3OLf.js").then(e=>e.E),__vite__mapDeps([12,1,2,3,4,5,6,7])).then(e=>({default:e.EventsPage}))),t.lazy(()=>r(()=>import("./PushNotificationManager-BjyUJ3Yv.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,10,11,12,18,19])).then(e=>({default:e.default}))),t.lazy(()=>r(()=>import("./BackgroundSyncManager-BM6Rid19.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,10,11,12,19])).then(e=>({default:e.default})));const I=({children:e,height:r=300})=>{const n=(s=r)<=200?"lazy-chart-wrapper-sm":s<=300?"lazy-chart-wrapper-md":s<=400?"lazy-chart-wrapper-lg":"lazy-chart-wrapper-xl";var s;return a.jsx("div",{className:n,children:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:`animate-pulse bg-gray-200 rounded-lg ${n}`,children:a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsx("div",{className:"text-gray-400",children:"Grafik yükleniyor..."})})}),children:e})})};export{e as DonationReportsPage};

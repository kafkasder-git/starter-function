function e(){const[e,p]=a.useState([]),[h,f]=a.useState(!0),[U,G]=a.useState(""),[K,V]=a.useState("all"),[q,L]=a.useState("all"),[Y,H]=a.useState("all"),[J,Q]=a.useState(!1),[W,X]=a.useState(!1),[Z,ee]=a.useState({name:"",type:"sozlesme",category:"medeni",relatedCase:"",description:"",file:null});a.useEffect(()=>{ae()},[]);const ae=async()=>{f(!0);try{const e=(await R.listFiles({folder:"legal-documents"})).files.map(e=>({id:parseInt(e.id)||Math.floor(1e6*Math.random()),name:e.name,type:e.metadata?.documentType||"diger",category:e.metadata?.category||"medeni",relatedCase:e.metadata?.caseNumber,uploadDate:e.createdAt.toISOString(),uploadedBy:e.uploadedBy||"Unknown",size:`${(e.size/1024/1024).toFixed(2)} MB`,status:"onaylandi",description:e.description||e.metadata?.description}));p(e)}catch(e){g.error("Failed to load legal documents",e),u.error("Belgeler yüklenirken hata oluştu")}finally{f(!1)}},te=e.filter(e=>{const a=""===U||e.name.toLowerCase().includes(U.toLowerCase())||e.uploadedBy.toLowerCase().includes(U.toLowerCase())||e.relatedCase?.includes(U),t="all"===K||e.type===K,l="all"===q||e.category===q,i="all"===Y||"approved"===Y&&"onaylandi"===e.status||"pending"===Y&&"bekliyor"===e.status;return a&&t&&l&&i}),le=e=>{const{label:a,className:l}={onaylandi:{label:"Onaylandı",className:"bg-green-50 text-green-700 border-green-200"},bekliyor:{label:"Bekliyor",className:"bg-yellow-50 text-yellow-700 border-yellow-200"},reddedildi:{label:"Reddedildi",className:"bg-red-50 text-red-700 border-red-200"}}[e];return t.jsx(_,{variant:"outline",className:`${l} px-2 py-1 text-xs`,children:a})},ie=e=>{const{label:a,className:l}={sozlesme:{label:"Sözleşme",className:"bg-blue-50 text-blue-700"},dilekce:{label:"Dilekçe",className:"bg-purple-50 text-purple-700"},karar:{label:"Karar",className:"bg-green-50 text-green-700"},tutanak:{label:"Tutanak",className:"bg-orange-50 text-orange-700"},rapor:{label:"Rapor",className:"bg-indigo-50 text-indigo-700"},diger:{label:"Diğer",className:"bg-gray-50 text-gray-700"}}[e];return t.jsx(_,{className:`${l} border border-gray-200 dark:border-gray-700 dark:bg-gray-900 px-2 py-1 text-xs`,children:a})},re=e.filter(e=>"onaylandi"===e.status).length,se=e.filter(e=>"bekliyor"===e.status).length,ne=e.filter(e=>{const a=new Date(e.uploadDate),t=new Date;return a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()}).length;return t.jsxs("div",{className:"flex-1 space-y-4 p-4 sm:space-y-6 sm:p-6",children:[t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-medium",children:"Hukuki Belgeler"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Hukuki belge yönetimi ve arşiv sistemi"})]}),t.jsxs(y,{className:"w-full gap-2 sm:w-auto",onClick:()=>{Q(!0)},children:[t.jsx(l,{className:"h-4 w-4"}),"Belge Yükle"]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-4",children:[t.jsx(w,{children:t.jsx(v,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-muted-foreground text-sm",children:"Toplam Belge"}),t.jsx("p",{className:"text-2xl font-medium",children:e.length})]}),t.jsx(i,{className:"text-muted-foreground h-5 w-5"})]})})}),t.jsx(w,{children:t.jsx(v,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-muted-foreground text-sm",children:"Onaylanan"}),t.jsx("p",{className:"text-2xl font-medium text-green-600",children:re})]}),t.jsx(r,{className:"h-5 w-5 text-green-600"})]})})}),t.jsx(w,{children:t.jsx(v,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-muted-foreground text-sm",children:"Bekleyen"}),t.jsx("p",{className:"text-2xl font-medium text-yellow-600",children:se})]}),t.jsx(s,{className:"h-5 w-5 text-yellow-600"})]})})}),t.jsx(w,{children:t.jsx(v,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-muted-foreground text-sm",children:"Bu Ay"}),t.jsx("p",{className:"text-2xl font-medium text-blue-600",children:ne})]}),t.jsx(n,{className:"h-5 w-5 text-blue-600"})]})})})]}),t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(c,{className:"text-muted-foreground absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform"}),t.jsx(x,{placeholder:"Belge ara...",value:U,onChange:e=>{G(e.target.value)},className:"pl-10"})]}),t.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[t.jsxs(b,{value:K,onValueChange:V,children:[t.jsx(N,{className:"w-[130px] shrink-0",children:t.jsx(k,{placeholder:"Belge Türü"})}),t.jsxs(D,{children:[t.jsx(z,{value:"all",children:"Tüm Türler"}),t.jsx(z,{value:"sozlesme",children:"Sözleşme"}),t.jsx(z,{value:"dilekce",children:"Dilekçe"}),t.jsx(z,{value:"karar",children:"Karar"}),t.jsx(z,{value:"tutanak",children:"Tutanak"}),t.jsx(z,{value:"rapor",children:"Rapor"}),t.jsx(z,{value:"diger",children:"Diğer"})]})]}),t.jsxs(b,{value:q,onValueChange:L,children:[t.jsx(N,{className:"w-[120px] shrink-0",children:t.jsx(k,{placeholder:"Kategori"})}),t.jsxs(D,{children:[t.jsx(z,{value:"all",children:"Tüm Kategoriler"}),t.jsx(z,{value:"medeni",children:"Medeni"}),t.jsx(z,{value:"ceza",children:"Ceza"}),t.jsx(z,{value:"is",children:"İş"}),t.jsx(z,{value:"idare",children:"İdare"}),t.jsx(z,{value:"ticaret",children:"Ticaret"}),t.jsx(z,{value:"aile",children:"Aile"})]})]})]})]}),t.jsxs(M,{value:Y,onValueChange:H,children:[t.jsxs(O,{className:"grid w-full grid-cols-3",children:[t.jsx(A,{value:"all",children:"Tümü"}),t.jsx(A,{value:"approved",children:"Onaylanmış"}),t.jsx(A,{value:"pending",children:"Bekleyen"})]}),t.jsx(I,{value:Y,className:"mt-4",children:h?t.jsx("div",{className:"flex justify-center py-8",children:t.jsx("div",{className:"text-muted-foreground",children:"Belgeler yükleniyor..."})}):t.jsx("div",{className:"grid gap-4",children:te.map(e=>t.jsxs(w,{className:"transition-shadow hover:shadow-md",children:[t.jsx(T,{className:"pb-3",children:t.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx(F,{className:"text-lg font-medium",children:e.name}),e.relatedCase&&t.jsxs("p",{className:"text-muted-foreground mt-1",children:["Dava No: ",e.relatedCase]}),t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[le(e.status),ie(e.type)]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(r,{className:"h-4 w-4"})}),t.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(o,{className:"h-4 w-4"})})]})]})}),t.jsxs(v,{className:"pt-0",children:[t.jsxs("div",{className:"mb-3 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(d,{className:"text-muted-foreground h-4 w-4"}),t.jsx("span",{className:"truncate",children:e.uploadedBy})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(m,{className:"text-muted-foreground h-4 w-4"}),t.jsx("span",{className:"truncate",children:new Date(e.uploadDate).toLocaleDateString("tr-TR")})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(i,{className:"text-muted-foreground h-4 w-4"}),t.jsx("span",{className:"truncate",children:e.size})]})]}),e.description&&t.jsx("div",{className:"rounded-lg bg-gray-50 p-3",children:t.jsx("p",{className:"text-sm text-gray-700",children:e.description})})]})]},e.id))})})]}),t.jsx(B,{open:J,onOpenChange:Q,children:t.jsxs(S,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[600px]",children:[t.jsxs(P,{children:[t.jsxs(C,{className:"flex items-center gap-2",children:[t.jsx(l,{className:"h-5 w-5"}),"Belge Yükle"]}),t.jsx(j,{children:"Hukuki belge bilgilerini doldurun. Zorunlu alanları (*) doldurmanız gereklidir."})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!(Z.name&&Z.type&&Z.category&&Z.file))return u.error("Lütfen zorunlu alanları doldurun"),void 0;try{X(!0);const e=await R.uploadFile(Z.file,{folder:"legal-documents",metadata:{documentType:Z.type,category:Z.category,caseNumber:Z.relatedCase,description:Z.description}});e.success?(u.success("Belge başarıyla yüklendi!"),Q(!1),ee({name:"",type:"sozlesme",category:"medeni",relatedCase:"",description:"",file:null}),await ae()):u.error(e.error||"Belge yüklenirken hata oluştu")}catch(a){g.error("Failed to upload legal document",a),u.error("Belge yüklenirken hata oluştu")}finally{X(!1)}},className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs($,{htmlFor:"name",children:["Belge Adı ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(x,{id:"name",value:Z.name,onChange:e=>{ee({...Z,name:e.target.value})},placeholder:"Örn: İdare Mahkemesi Dilekçesi",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs($,{htmlFor:"type",children:["Belge Türü ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs(b,{value:Z.type,onValueChange:e=>{ee({...Z,type:e})},children:[t.jsx(N,{children:t.jsx(k,{placeholder:"Tür seçin"})}),t.jsxs(D,{children:[t.jsx(z,{value:"sozlesme",children:"Sözleşme"}),t.jsx(z,{value:"dilekce",children:"Dilekçe"}),t.jsx(z,{value:"karar",children:"Karar"}),t.jsx(z,{value:"tutanak",children:"Tutanak"}),t.jsx(z,{value:"rapor",children:"Rapor"}),t.jsx(z,{value:"diger",children:"Diğer"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs($,{htmlFor:"category",children:["Kategori ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs(b,{value:Z.category,onValueChange:e=>{ee({...Z,category:e})},children:[t.jsx(N,{children:t.jsx(k,{placeholder:"Kategori seçin"})}),t.jsxs(D,{children:[t.jsx(z,{value:"medeni",children:"Medeni"}),t.jsx(z,{value:"ceza",children:"Ceza"}),t.jsx(z,{value:"is",children:"İş"}),t.jsx(z,{value:"idare",children:"İdare"}),t.jsx(z,{value:"ticaret",children:"Ticaret"}),t.jsx(z,{value:"aile",children:"Aile"})]})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx($,{htmlFor:"relatedCase",children:"İlgili Dava Numarası"}),t.jsx(x,{id:"relatedCase",value:Z.relatedCase,onChange:e=>{ee({...Z,relatedCase:e.target.value})},placeholder:"Örn: 2024/123"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx($,{htmlFor:"description",children:"Açıklama"}),t.jsx(E,{id:"description",value:Z.description,onChange:e=>{ee({...Z,description:e.target.value})},placeholder:"Belge hakkında ek bilgiler",rows:3})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs($,{htmlFor:"file",children:["Dosya Seç ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(x,{id:"file",type:"file",accept:".pdf,.doc,.docx",className:"cursor-pointer",onChange:e=>{ee({...Z,file:e.target.files?.[0]||null})}}),t.jsx("p",{className:"text-muted-foreground text-xs",children:"Desteklenen formatlar: PDF, DOC, DOCX (Maks. 10MB)"})]}),t.jsxs("div",{className:"flex justify-end gap-2 border-t pt-4",children:[t.jsx(y,{type:"button",variant:"outline",onClick:()=>{Q(!1)},disabled:W,children:"İptal"}),t.jsx(y,{type:"submit",disabled:W,children:W?"Yükleniyor...":"Belge Yükle"})]})]})]})})]})}import{r as a,j as t,c8 as l,a5 as i,E as r,aq as s,aa as n,l as c,a2 as o,bG as d,a9 as m}from"./react-vendor-Zi_jsHoK.js";import{t as u}from"./toast-vendor-Ci27VDWJ.js";import{y as p,u as h,l as g,x as f,B as y,C as w,e as v,I as x,S as b,j as N,k,m as D,n as z,a as T,b as F,o as B,p as S,q as P,r as C,s as j,t as $,v as E,f as _}from"./beneficiaries-page-CkZlrYV8.js";import{T as M,a as O,b as A,c as I}from"./tabs-fYszpb1R.js";import{m as U}from"./index-B_tRywLG.js";import{I as G,Q as K}from"./appwrite-vendor-Ct7vfU_L.js";import"./ui-vendor-f6_gbUtQ.js";import"./utils-vendor-CH-VcvGo.js";import"./motion-vendor-iBxafAnt.js";import"./user-management-page-B6-AaFFc.js";import"./messaging-page-BEU6nUaR.js";import"./events-finance-page-DWyC3OLf.js";const V={buckets:{documents:{name:"documents",isPublic:!1,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"],maxSize:10485760,versioning:!0,encryption:!0,compression:!1},images:{name:"images",isPublic:!0,allowedTypes:["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"],maxSize:5242880,versioning:!0,encryption:!1,compression:!0},reports:{name:"reports",isPublic:!1,allowedTypes:["application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],maxSize:52428800,versioning:!0,encryption:!0,compression:!0},temp:{name:"temp",isPublic:!1,allowedTypes:["*/*"],maxSize:104857600,retention:7,versioning:!1,encryption:!1,compression:!1},backups:{name:"backups",isPublic:!1,allowedTypes:["application/zip","application/gzip","application/x-tar"],maxSize:524288e3,versioning:!0,encryption:!0,compression:!0}},defaultBucket:"documents",uploadLimits:{maxFileSize:104857600,maxFilesPerUpload:10,allowedMimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","text/csv","application/zip","application/gzip","application/x-tar"]},security:{enableVirusScan:p.features.security?.virusScan||!1,enableContentModeration:p.features.security?.contentModeration||!1,enableWatermarking:p.features.security?.watermarking||!1,enableEncryption:p.features.security?.encryption||!1},allowAnonymousUploads:!1};class q{static instance;config;constructor(){this.config=V,this.initializeBuckets()}static getInstance(){return q.instance||(q.instance=new q),q.instance}getCurrentUserId(){const e=h.getState().user;return e?.id||"system"}async initializeBuckets(){try{g.info("Using Appwrite Storage with buckets:",Object.keys(this.config.buckets)),U.trackEvent({type:"file_storage_initialized",category:"storage",action:"initialize",metadata:{buckets:Object.keys(this.config.buckets),totalBuckets:Object.keys(this.config.buckets).length}})}catch(e){g.error("Failed to initialize buckets:",e)}}async uploadFile(e,a={}){const t=Date.now();try{if(!this.config.allowAnonymousUploads&&!h.getState().user)return void U.trackSecurityEvent("unauthorized_upload_attempt",{bucket:a.bucket||this.config.defaultBucket,fileName:e.name,ip:void 0}),{success:!1,error:"Authentication required for file uploads"};const i=this.validateFile(e,a);if(!i.valid)return{success:!1,error:i.error||"Validation failed"};const r=a.bucket||this.config.defaultBucket,s=a.folder||"",n=this.generateUniqueFileName(e.name,a.overwrite),c=s?`${s}/${n}`:n;if(!a.overwrite)try{const e=await f.listFiles(r,[]),a=e.files?.some(e=>e.name===n);if(a)return{success:!1,error:`File already exists: ${n}. Set overwrite=true to replace.`}}catch(l){g.warn("Could not check for existing file:",l)}let o=e;a.compress&&(o=await this.processFile(e));let d=0;const m=setInterval(()=>{d+=10,d>=90&&(d=90,clearInterval(m)),a.onProgress?.(d)},200),u=this.getCurrentUserId(),p=await f.createFile(r,G.unique(),o);if(!p)throw clearInterval(m),new Error("Failed to upload file");const y=f.getFileView(r,p.$id),w={id:p.$id,name:p.name,size:p.sizeOriginal,type:p.mimeType,bucket:r,path:c,url:y.toString(),createdAt:new Date(p.$createdAt),updatedAt:new Date(p.$updatedAt),uploadedBy:u,isPublic:a.isPublic||!1,downloadCount:0,tags:a.tags||[],description:a.description||"",metadata:a.metadata||{}};await this.saveFileMetadata(w),clearInterval(m),a.onProgress?.(100);const v=Date.now()-t,x={success:!0,file:w,url:w.url,path:w.path};return U.trackApiCall("file_storage/upload","POST",v,200,{bucket:r,fileSize:e.size,fileType:e.type,compressed:a.compress||!1,userId:u}),x}catch(l){const a=Date.now()-t,i={success:!1,error:l.message};return U.trackApiCall("file_storage/upload","POST",a,500,{fileSize:e.size,fileType:e.type,error:l.message}),i}}async uploadFiles(e,a={}){const t=[];if(e.length>this.config.uploadLimits.maxFilesPerUpload){const a={success:!1,error:`Too many files. Maximum allowed: ${this.config.uploadLimits.maxFilesPerUpload}`};return new Array(e.length).fill(a)}let l=0;const i=e.length;for(const r of e){const s=await this.uploadFile(r,{...a,onProgress:e=>{const t=(l+e/100)/i*100;a.onProgress?.(Math.round(t))}});t.push(s),l++,e.length>1&&await new Promise(e=>setTimeout(e,100))}return a.onProgress?.(100),t}async listFiles(e={}){const a=Date.now();try{const t=e.bucket||this.config.defaultBucket,l=e.folder||"",i=e.limit||50,r=e.offset||0,s=await f.listFiles(t,[K.limit(i),K.offset(r),K.orderAsc(e.sortBy||"name")]);e.search;const n=await f.listFiles(t,[K.limit(1e3)]),c=n?.files?.length||0,o=r+i<c,d=(s?.files||[]).map(e=>({id:e.$id,name:e.name,size:e.sizeOriginal,type:e.mimeType,bucket:t,path:l?`${l}/${e.name}`:e.name,url:f.getFileView(t,e.$id).toString(),createdAt:new Date(e.$createdAt),updatedAt:new Date(e.$updatedAt),uploadedBy:e.uploadedBy||this.getCurrentUserId(),isPublic:this.config.buckets[t]?.isPublic||!1,downloadCount:0,tags:e.tags?JSON.parse(e.tags):[],description:e.description||"",metadata:e.metadata||{}})),m=Date.now()-a,u={files:d,total:c,hasMore:o,nextOffset:o?r+i:0};return U.trackApiCall("file_storage/list","GET",m,200,{bucket:t,count:d.length,total:c,hasMore:o}),u}catch(t){const l=Date.now()-a;throw U.trackApiCall("file_storage/list","GET",l,500,{bucket:e.bucket||this.config.defaultBucket,error:t.message}),t}}async getFileInfo(e,a){const t=Date.now();try{const l=await f.getFile(e,a);if(!l)return null;const i={id:l.$id,name:l.name,size:l.sizeOriginal,type:l.mimeType,bucket:e,path:a,url:f.getFileView(e,l.$id).toString(),createdAt:new Date(l.$createdAt),updatedAt:new Date(l.$updatedAt),uploadedBy:l.uploadedBy||this.getCurrentUserId(),isPublic:this.config.buckets[e]?.isPublic||!1,downloadCount:0,tags:l.tags?JSON.parse(l.tags):[],description:l.description||"",metadata:l.metadata||{}},r=Date.now()-t;return U.trackApiCall("file_storage/info","GET",r,200,{bucket:e,filePath:a}),i}catch(l){const i=Date.now()-t;throw U.trackApiCall("file_storage/info","GET",i,500,{bucket:e,filePath:a,error:l.message}),l}}async downloadFile(e,a,t={}){const l=Date.now();try{const t=await f.getFileDownload(e,a);if(!t)throw new Error("File not found");await this.incrementDownloadCount(e,a);const i=Date.now()-l;return U.trackApiCall("file_storage/download","GET",i,200,{bucket:e,filePath:a,fileSize:"string"==typeof t?t.length:t.size}),"string"==typeof t?new Blob([t]):t}catch(i){const t=Date.now()-l;throw U.trackApiCall("file_storage/download","GET",t,500,{bucket:e,filePath:a,error:i.message}),i}}async getFileUrl(e,a,t=3600){const l=Date.now();try{const i=f.getFileView(e,a).toString(),r=Date.now()-l;return U.trackApiCall("file_storage/url","GET",r,200,{bucket:e,filePath:a,expiresIn:t}),i}catch(i){const t=Date.now()-l;throw U.trackApiCall("file_storage/url","GET",t,500,{bucket:e,filePath:a,error:i.message}),i}}async deleteFile(e,a){const t=Date.now();try{await f.deleteFile(e,a),await this.deleteFileMetadata(e,a);const l=Date.now()-t;return U.trackApiCall("file_storage/delete","DELETE",l,200,{bucket:e,filePath:a}),!0}catch(l){const i=Date.now()-t;throw U.trackApiCall("file_storage/delete","DELETE",i,500,{bucket:e,filePath:a,error:l.message}),l}}async copyFile(e,a,t,l){const i=Date.now();try{const r=await f.getFileDownload(e,a);if(!r)throw new Error("Source file not found or could not be downloaded.");const s=new File([r],l.split("/").pop()||"copied_file",{type:"string"==typeof r?"text/plain":r.type}),n=await this.uploadFile(s,{bucket:t,folder:l.substring(0,l.lastIndexOf("/")),overwrite:!0});if(!n.success||!n.file)throw new Error(n.error||"Failed to upload copied file.");const c=Date.now()-i;return U.trackApiCall("file_storage/copy","POST",c,200,{sourceBucket:e,sourcePath:a,targetBucket:t,targetPath:l,fileSize:"string"==typeof r?r.length:r.size}),n.file}catch(r){const s=Date.now()-i;throw U.trackApiCall("file_storage/copy","POST",s,500,{sourceBucket:e,sourcePath:a,targetBucket:t,targetPath:l,error:r.message}),r}}validateFile(e,a){if(!e.type)return{valid:!1,error:"Unable to determine file type. Please upload a file with a valid MIME type."};const t=a.maxSize||this.config.uploadLimits.maxFileSize;if(e.size>t)return{valid:!1,error:`File size exceeds limit: ${t} bytes`};const l=a.allowedTypes||this.config.uploadLimits.allowedMimeTypes;if(!l.includes("*/*")&&!l.includes(e.type))return{valid:!1,error:`File type not allowed: ${e.type}`};const i=a.bucket||this.config.defaultBucket,r=this.config.buckets[i];if(r){if(e.size>r.maxSize)return{valid:!1,error:`File size exceeds bucket limit: ${r.maxSize} bytes`};if(!r.allowedTypes.includes("*/*")&&!r.allowedTypes.includes(e.type))return{valid:!1,error:`File type not allowed in bucket ${i}: ${e.type}`}}return{valid:!0}}generateUniqueFileName(e,a=!1){if(a)return e;const t=Date.now();let l;if("undefined"!=typeof crypto&&crypto.randomUUID)l=crypto.randomUUID().replace(/-/g,"").substring(0,9);else if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){const e=new Uint8Array(9);window.crypto.getRandomValues(e),l=Array.from(e,e=>e.toString(36)).join("").substring(0,9)}else l=Math.random().toString(36).substr(2,9);const i=e.split(".").pop();return`${e.replace(`.${i}`,"")}_${t}_${l}.${i}`}async processFile(e){return e}async saveFileMetadata(e){g.info("Saving file metadata:",e)}async deleteFileMetadata(e,a){g.info("Deleting file metadata:",{bucket:e,filePath:a})}async incrementDownloadCount(e,a){g.info("Incrementing download count:",{bucket:e,filePath:a})}async getStorageStats(){const e={totalFiles:0,totalSize:0,bucketStats:{},recentUploads:[]};for(const[t,l]of Object.entries(this.config.buckets))try{const{files:a}=await f.listFiles(l.name),t=a||[],i=t.reduce((e,a)=>e+(a.sizeOriginal||0),0);e.bucketStats[l.name]={files:t.length,size:i},e.totalFiles+=t.length,e.totalSize+=i}catch(a){g.error(`Failed to get stats for bucket ${l.name}:`,a)}return e.recentUploads=[],e}async testStorage(){const e=[];try{for(const[l,i]of Object.entries(this.config.buckets))try{await f.listFiles(i.name,[K.limit(1)])}catch(a){e.push(`Failed to test bucket ${i.name}: ${a.message}`)}const t=new File(["test"],"test.txt",{type:"text/plain"});try{const e=await this.uploadFile(t,{bucket:"temp",folder:"test",isPublic:!1});e.success&&e.path&&await this.deleteFile("temp",e.path)}catch(a){e.push(`Upload/download test failed: ${a.message}`)}}catch(a){e.push(`Storage test failed: ${a.message}`)}return{success:0===e.length,errors:e}}}const R=q.getInstance();export{e as LegalDocumentsPage,e as default};

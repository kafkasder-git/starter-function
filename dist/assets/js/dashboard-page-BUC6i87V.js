function e(){const{user:e,logout:m}=y(),[h,D]=t.useState(null),[A,j]=t.useState(!0),[E,k]=t.useState(null);return t.useEffect(()=>{e&&(async()=>{try{j(!0),k(null);const[t,a,s,n,r,i,c,l,d]=await Promise.all([C.getCollectionStats("users"),C.getCollectionStats("donations"),C.getCollectionStats("beneficiaries"),C.getCollectionStats("scholarships"),C.getCollectionStats("events"),C.getCollectionStats("messages"),C.listDonations(5,0),C.listAidRequests(5,0),$.getUserMessages(e?.id||"",5)]);D({totalUsers:t.total,totalDonations:a.total,totalBeneficiaries:s.total,totalScholarships:n.total,totalEvents:r.total,totalMessages:i.total,recentDonations:c.documents,recentAidRequests:l.documents,recentMessages:d})}catch(t){k("Dashboard verileri yüklenemedi")}finally{j(!1)}})()},[e]),A?a.jsx("div",{className:"flex min-h-screen w-full items-center justify-center bg-gray-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Dashboard yükleniyor..."})]})}):E?a.jsx("div",{className:"flex min-h-screen w-full items-center justify-center bg-gray-50",children:a.jsxs(p,{className:"max-w-md",children:[a.jsxs(w,{children:[a.jsx(f,{className:"text-red-600",children:"Hata"}),a.jsx(x,{children:E})]}),a.jsx(b,{children:a.jsx(g,{onClick:()=>{window.location.reload()},className:"w-full",children:"Tekrar Dene"})})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs(N,{level:1,size:"3xl",weight:"bold",className:"text-gray-900",children:["Hoş Geldiniz, ",e?.name||"Kullanıcı","!"]}),a.jsx(v,{size:"lg",color:"neutral",className:"mt-2",children:"Dernek Yönetim Sistemi Dashboard'u"})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(I,{variant:"secondary",className:"flex items-center space-x-2",children:[a.jsx(s,{className:"h-4 w-4"}),a.jsx("span",{children:e?.role||"Kullanıcı"})]}),a.jsx(g,{onClick:()=>m(),variant:"outline",children:"Çıkış Yap"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:[a.jsxs(p,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(f,{className:"text-sm font-medium",children:"Kullanıcılar"}),a.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(b,{children:[a.jsx("div",{className:"text-2xl font-bold",children:h?.totalUsers||0}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Toplam kayıtlı kullanıcı"})]})]}),a.jsxs(p,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(f,{className:"text-sm font-medium",children:"Bağışlar"}),a.jsx(r,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(b,{children:[a.jsx("div",{className:"text-2xl font-bold",children:h?.totalDonations||0}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Toplam bağış sayısı"})]})]}),a.jsxs(p,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(f,{className:"text-sm font-medium",children:"İhtiyaç Sahipleri"}),a.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(b,{children:[a.jsx("div",{className:"text-2xl font-bold",children:h?.totalBeneficiaries||0}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Kayıtlı ihtiyaç sahibi"})]})]}),a.jsxs(p,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(f,{className:"text-sm font-medium",children:"Burslar"}),a.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(b,{children:[a.jsx("div",{className:"text-2xl font-bold",children:h?.totalScholarships||0}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Aktif burs sayısı"})]})]}),a.jsxs(p,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(f,{className:"text-sm font-medium",children:"Etkinlikler"}),a.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(b,{children:[a.jsx("div",{className:"text-2xl font-bold",children:h?.totalEvents||0}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Planlanan etkinlik"})]})]}),a.jsxs(p,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(f,{className:"text-sm font-medium",children:"Mesajlar"}),a.jsx(l,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(b,{children:[a.jsx("div",{className:"text-2xl font-bold",children:h?.totalMessages||0}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Gönderilen mesaj"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs(p,{children:[a.jsxs(w,{children:[a.jsxs(f,{className:"flex items-center space-x-2",children:[a.jsx(d,{className:"h-5 w-5"}),a.jsx("span",{children:"Son Bağışlar"})]}),a.jsx(x,{children:"En son yapılan bağışlar"})]}),a.jsx(b,{children:a.jsx("div",{className:"space-y-4",children:h?.recentDonations?.length>0?h.recentDonations.map((e,t)=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:e.donorName}),a.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.donationDate).toLocaleDateString("tr-TR")})]})]}),a.jsxs(I,{variant:"outline",children:[e.amount," ",e.currency]})]},t)):a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Henüz bağış kaydı bulunmuyor"})})})]}),a.jsxs(p,{children:[a.jsxs(w,{children:[a.jsxs(f,{className:"flex items-center space-x-2",children:[a.jsx(o,{className:"h-5 w-5"}),a.jsx("span",{children:"Son Yardım Başvuruları"})]}),a.jsx(x,{children:"En son gelen yardım başvuruları"})]}),a.jsx(b,{children:a.jsx("div",{className:"space-y-4",children:h?.recentAidRequests?.length>0?h.recentAidRequests.map((e,t)=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm font-medium",children:[e.requestType," Başvurusu"]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.requestDate).toLocaleDateString("tr-TR")})]})]}),a.jsx(I,{variant:"onaylandı"===e.status?"default":"secondary",children:e.status})]},t)):a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Henüz yardım başvurusu bulunmuyor"})})})]})]}),a.jsxs(p,{children:[a.jsxs(w,{children:[a.jsxs(f,{className:"flex items-center space-x-2",children:[a.jsx(s,{className:"h-5 w-5"}),a.jsx("span",{children:"Hızlı İşlemler"})]}),a.jsx(x,{children:"Sık kullanılan işlemler için hızlı erişim"})]}),a.jsx(b,{children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs(g,{className:"h-20 flex flex-col items-center justify-center space-y-2",variant:"outline",children:[a.jsx(r,{className:"h-6 w-6"}),a.jsx("span",{className:"text-sm",children:"Yeni Bağış"})]}),a.jsxs(g,{className:"h-20 flex flex-col items-center justify-center space-y-2",variant:"outline",children:[a.jsx(n,{className:"h-6 w-6"}),a.jsx("span",{className:"text-sm",children:"İhtiyaç Sahibi"})]}),a.jsxs(g,{className:"h-20 flex flex-col items-center justify-center space-y-2",variant:"outline",children:[a.jsx(o,{className:"h-6 w-6"}),a.jsx("span",{className:"text-sm",children:"Yardım Başvurusu"})]}),a.jsxs(g,{className:"h-20 flex flex-col items-center justify-center space-y-2",variant:"outline",children:[a.jsx(l,{className:"h-6 w-6"}),a.jsx("span",{className:"text-sm",children:"Mesaj Gönder"})]})]})})]}),a.jsxs(p,{children:[a.jsxs(w,{children:[a.jsxs(f,{className:"flex items-center space-x-2",children:[a.jsx(u,{className:"h-5 w-5"}),a.jsx("span",{children:"Sistem Durumu"})]}),a.jsx(x,{children:"Sistem bileşenlerinin durumu"})]}),a.jsx(b,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:"Veritabanı"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Bağlantı aktif"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:"Mesajlaşma"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Servis aktif"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:"Dosya Depolama"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Depolama aktif"})]})]})]})})]})]})})}import{r as t,j as a,ab as s,$ as n,H as r,ac as i,a9 as c,ad as l,a1 as d,ae as o,o as u}from"./react-vendor-Zi_jsHoK.js";import{d as m,D as h,u as y,C as p,a as w,b as f,c as x,e as b,B as g,H as N,T as v,f as I}from"./beneficiaries-page-CkZlrYV8.js";import{I as D,Q as A}from"./appwrite-vendor-Ct7vfU_L.js";import"./ui-vendor-f6_gbUtQ.js";import"./utils-vendor-CH-VcvGo.js";import"./toast-vendor-Ci27VDWJ.js";import"./motion-vendor-iBxafAnt.js";const j="users",E="donations",k="beneficiaries",q="aid_requests",S="scholarships",B="events",T="partners",M="financial_transactions",C=new class{async createDocument(e,t){try{return await m.createDocument({databaseId:h,collectionId:e,documentId:D.unique(),data:t})}catch(a){throw new Error(`Document oluşturulamadı: ${a.message}`)}}async getDocument(e,t){try{return await m.getDocument({databaseId:h,collectionId:e,documentId:t})}catch(a){throw new Error(`Document alınamadı: ${a.message}`)}}async listDocuments(e,t=[],a=25,s=0){try{const n=await m.listDocuments({databaseId:h,collectionId:e,queries:[...t,A.limit(a),A.offset(s),A.orderDesc("$createdAt")]});return{documents:n.documents,total:n.total}}catch(n){throw new Error(`Documents listelenemedi: ${n.message}`)}}async updateDocument(e,t,a){try{return await m.updateDocument({databaseId:h,collectionId:e,documentId:t,data:a})}catch(s){throw new Error(`Document güncellenemedi: ${s.message}`)}}async deleteDocument(e,t){try{await m.deleteDocument({databaseId:h,collectionId:e,documentId:t})}catch(a){throw new Error(`Document silinemedi: ${a.message}`)}}async createUser(e){return this.createDocument(j,e)}async getUser(e){return this.getDocument(j,e)}async listUsers(e=25,t=0){return this.listDocuments(j,[],e,t)}async updateUser(e,t){return this.updateDocument(j,e,t)}async deleteUser(e){return this.deleteDocument(j,e)}async createDonation(e){return this.createDocument(E,e)}async getDonation(e){return this.getDocument(E,e)}async listDonations(e=25,t=0){return this.listDocuments(E,[],e,t)}async updateDonation(e,t){return this.updateDocument(E,e,t)}async deleteDonation(e){return this.deleteDocument(E,e)}async createBeneficiary(e){return this.createDocument(k,e)}async getBeneficiary(e){return this.getDocument(k,e)}async listBeneficiaries(e=25,t=0){return this.listDocuments(k,[],e,t)}async updateBeneficiary(e,t){return this.updateDocument(k,e,t)}async deleteBeneficiary(e){return this.deleteDocument(k,e)}async createAidRequest(e){return this.createDocument(q,e)}async getAidRequest(e){return this.getDocument(q,e)}async listAidRequests(e=25,t=0){return this.listDocuments(q,[],e,t)}async updateAidRequest(e,t){return this.updateDocument(q,e,t)}async deleteAidRequest(e){return this.deleteDocument(q,e)}async createScholarship(e){return this.createDocument(S,e)}async getScholarship(e){return this.getDocument(S,e)}async listScholarships(e=25,t=0){return this.listDocuments(S,[],e,t)}async updateScholarship(e,t){return this.updateDocument(S,e,t)}async deleteScholarship(e){return this.deleteDocument(S,e)}async createEvent(e){return this.createDocument(B,e)}async getEvent(e){return this.getDocument(B,e)}async listEvents(e=25,t=0){return this.listDocuments(B,[],e,t)}async updateEvent(e,t){return this.updateDocument(B,e,t)}async deleteEvent(e){return this.deleteDocument(B,e)}async createPartner(e){return this.createDocument(T,e)}async getPartner(e){return this.getDocument(T,e)}async listPartners(e=25,t=0){return this.listDocuments(T,[],e,t)}async updatePartner(e,t){return this.updateDocument(T,e,t)}async deletePartner(e){return this.deleteDocument(T,e)}async createFinancialTransaction(e){return this.createDocument(M,e)}async getFinancialTransaction(e){return this.getDocument(M,e)}async listFinancialTransactions(e=25,t=0){return this.listDocuments(M,[],e,t)}async updateFinancialTransaction(e,t){return this.updateDocument(M,e,t)}async deleteFinancialTransaction(e){return this.deleteDocument(M,e)}async searchDocuments(e,t,a,s=25,n=0){try{const r=a.map(e=>A.search(e,t)),i=await m.listDocuments({databaseId:h,collectionId:e,queries:[A.or(r),A.limit(s),A.offset(n),A.orderDesc("$createdAt")]});return{documents:i.documents,total:i.total}}catch(r){throw new Error(`Search işlemi başarısız: ${r.message}`)}}async getCollectionStats(e){try{const t=await m.listDocuments({databaseId:h,collectionId:e,queries:[A.limit(1)]});let a=0,s=0;try{a=(await m.listDocuments({databaseId:h,collectionId:e,queries:[A.equal("status","aktif"),A.limit(1)]})).total}catch{}try{s=(await m.listDocuments({databaseId:h,collectionId:e,queries:[A.equal("status","pasif"),A.limit(1)]})).total}catch{}return{total:t.total,active:a,inactive:s}}catch(t){throw new Error(`Stats alınamadı: ${t.message}`)}}},$=new class{collectionId="messages";bulkCollectionId="bulk_messages";templatesCollectionId="message_templates";settingsCollectionId="notification_settings";async createConversation(e,t){try{return(await m.createDocument(h,"conversations",D.unique(),{name:t||`Konuşma ${(new Date).toLocaleDateString()}`,participants:e,createdBy:"current-user",status:"active",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})).$id}catch(a){throw new Error("Konuşma oluşturulamadı")}}async sendMessage(e){try{const t={...e,id:D.unique(),createdAt:new Date,updatedAt:new Date};return await m.createDocument({databaseId:h,collectionId:this.collectionId,documentId:t.id,data:{senderId:t.senderId,recipientIds:t.recipientIds,subject:t.subject,content:t.content,type:t.type,status:t.status,priority:t.priority,scheduledAt:t.scheduledAt?.toISOString(),sentAt:t.sentAt?.toISOString(),attachments:t.attachments||[],metadata:t.metadata||{},createdAt:t.createdAt.toISOString(),updatedAt:t.updatedAt.toISOString()}}),await this.deliverMessage(t),t}catch(t){throw new Error("Mesaj gönderilemedi")}}async sendBulkMessage(e){try{const t={...e,id:D.unique(),sentCount:0,failedCount:0,createdAt:new Date,updatedAt:new Date};return await m.createDocument({databaseId:h,collectionId:this.bulkCollectionId,documentId:t.id,data:{senderId:t.senderId,recipientGroups:t.recipientGroups,subject:t.subject,content:t.content,type:t.type,status:t.status,totalRecipients:t.totalRecipients,sentCount:t.sentCount,failedCount:t.failedCount,scheduledAt:t.scheduledAt?.toISOString(),sentAt:t.sentAt?.toISOString(),createdAt:t.createdAt.toISOString(),updatedAt:t.updatedAt.toISOString()}}),await this.processBulkMessage(t),t}catch(t){throw new Error("Toplu mesaj gönderilemedi")}}async createTemplate(e){try{const t={...e,id:D.unique(),createdAt:new Date,updatedAt:new Date};return await m.createDocument({databaseId:h,collectionId:this.templatesCollectionId,documentId:t.id,data:{name:t.name,type:t.type,subject:t.subject,content:t.content,variables:t.variables,isActive:t.isActive,createdAt:t.createdAt.toISOString(),updatedAt:t.updatedAt.toISOString()}}),t}catch(t){throw new Error("Mesaj şablonu oluşturulamadı")}}async getTemplates(e){try{const t=e?[{type:"equal",attribute:"type",value:e}]:[];return(await m.listDocuments({databaseId:h,collectionId:this.templatesCollectionId,queries:t})).documents.map(e=>({id:e.$id,name:e.name,type:e.type,subject:e.subject,content:e.content,variables:e.variables,isActive:e.isActive,createdAt:new Date(e.$createdAt),updatedAt:new Date(e.$updatedAt)}))}catch(t){throw new Error("Mesaj şablonları listelenemedi")}}async getUserMessages(e,t=50){try{return(await m.listDocuments({databaseId:h,collectionId:this.collectionId,queries:[{type:"equal",attribute:"recipientIds",value:e},{type:"limit",value:t},{type:"orderDesc",attribute:"$createdAt"}]})).documents.map(e=>({id:e.$id,senderId:e.senderId,recipientIds:e.recipientIds,subject:e.subject,content:e.content,type:e.type,status:e.status,priority:e.priority,scheduledAt:e.scheduledAt?new Date(e.scheduledAt):void 0,sentAt:e.sentAt?new Date(e.sentAt):void 0,attachments:e.attachments,metadata:e.metadata,createdAt:new Date(e.$createdAt),updatedAt:new Date(e.$updatedAt)}))}catch(a){throw new Error("Kullanıcı mesajları listelenemedi")}}async updateMessageStatus(e,t){try{await m.updateDocument({databaseId:h,collectionId:this.collectionId,documentId:e,data:{status:t,updatedAt:(new Date).toISOString()}})}catch(a){throw new Error("Mesaj durumu güncellenemedi")}}async saveNotificationSettings(e){try{const t=await m.listDocuments({databaseId:h,collectionId:this.settingsCollectionId,queries:[{type:"equal",attribute:"userId",value:e.userId}]}),a={userId:e.userId,emailEnabled:e.emailEnabled,smsEnabled:e.smsEnabled,pushEnabled:e.pushEnabled,digestEnabled:e.digestEnabled,digestFrequency:e.digestFrequency,quietHours:e.quietHours,updatedAt:(new Date).toISOString()};t.documents.length>0?await m.updateDocument({databaseId:h,collectionId:this.settingsCollectionId,documentId:t.documents[0].$id,data:a}):await m.createDocument({databaseId:h,collectionId:this.settingsCollectionId,documentId:D.unique(),data:{...a,createdAt:(new Date).toISOString()}})}catch(t){throw new Error("Bildirim ayarları kaydedilemedi")}}async getNotificationSettings(e){try{const t=await m.listDocuments({databaseId:h,collectionId:this.settingsCollectionId,queries:[{type:"equal",attribute:"userId",value:e}]});if(0===t.documents.length)return null;const a=t.documents[0];return{userId:a.userId,emailEnabled:a.emailEnabled,smsEnabled:a.smsEnabled,pushEnabled:a.pushEnabled,digestEnabled:a.digestEnabled,digestFrequency:a.digestFrequency,quietHours:a.quietHours}}catch(t){throw new Error("Bildirim ayarları alınamadı")}}async deliverMessage(e){try{switch(e.type){case"email":await this.sendEmail(e);break;case"sms":await this.sendSMS(e);break;case"push":await this.sendPushNotification(e);break;case"internal":break;default:throw new Error(`Desteklenmeyen mesaj türü: ${e.type}`)}await this.updateMessageStatus(e.id,"sent")}catch(t){throw await this.updateMessageStatus(e.id,"failed"),t}}async sendEmail(e){await new Promise(e=>setTimeout(e,1e3))}async sendSMS(e){await new Promise(e=>setTimeout(e,500))}async sendPushNotification(e){await new Promise(e=>setTimeout(e,300))}async processBulkMessage(e){try{const a=await this.getRecipientsFromGroups(e.recipientGroups);for(const s of a)try{const t={id:D.unique(),senderId:e.senderId,recipientIds:[s],subject:e.subject,content:e.content,type:e.type,status:"sent",priority:"normal",createdAt:new Date,updatedAt:new Date};await this.deliverMessage(t),e.sentCount++}catch(t){e.failedCount++}await m.updateDocument({databaseId:h,collectionId:this.bulkCollectionId,documentId:e.id,data:{status:0===e.failedCount?"sent":"failed",sentCount:e.sentCount,failedCount:e.failedCount,sentAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}})}catch(t){throw t}}async getRecipientsFromGroups(e){return["user1","user2","user3","user4","user5"]}};export{e as default};

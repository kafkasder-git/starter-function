name: ğŸ”§ Environment Setup & Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  environment-validation:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ—ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install Dependencies
      run: npm ci
      
    - name: ğŸ” Environment Variables Validation
      run: |
        echo "ğŸ”§ Environment Variables KontrolÃ¼ BaÅŸlatÄ±lÄ±yor..."
        
        # Environment dosyalarÄ±nÄ±n varlÄ±ÄŸÄ±nÄ± kontrol et
        if [ -f ".env.example" ]; then
          echo "âœ… .env.example dosyasÄ± mevcut"
        else
          echo "âŒ .env.example dosyasÄ± bulunamadÄ±"
          exit 1
        fi
        
        # Gerekli environment variables'larÄ± kontrol et
        echo "ğŸ“‹ Gerekli Environment Variables:"
        echo "- VITE_APPWRITE_ENDPOINT"
        echo "- VITE_APPWRITE_PROJECT_ID"
        echo "- VITE_APPWRITE_PROJECT_NAME"
        echo "- VITE_APPWRITE_DATABASE_ID"
        echo "- APPWRITE_API_KEY"
        
    - name: ğŸ§ª Environment Test
      run: |
        echo "ğŸ§ª Environment Test BaÅŸlatÄ±lÄ±yor..."
        npm run test:environment || echo "âš ï¸ Environment test bulunamadÄ±, devam ediliyor..."
        
    - name: ğŸ”¨ Build Test
      run: |
        echo "ğŸ”¨ Build Test BaÅŸlatÄ±lÄ±yor..."
        npm run build
        
    - name: ğŸ“Š Environment Setup Raporu
      run: |
        echo "ğŸ“Š Environment Setup Raporu:"
        echo "âœ… Repository checkout tamamlandÄ±"
        echo "âœ… Node.js setup tamamlandÄ±"
        echo "âœ… Dependencies install edildi"
        echo "âœ… Environment validation tamamlandÄ±"
        echo "âœ… Build test baÅŸarÄ±lÄ±"
        echo ""
        echo "ğŸ¯ Sonraki AdÄ±mlar:"
        echo "1. GitHub Secrets ayarlayÄ±n"
        echo "2. APPWRITE_API_KEY deÄŸerini gÃ¼ncelleyin"
        echo "3. Deployment'Ä± baÅŸlatÄ±n"
        
  deployment-check:
    runs-on: ubuntu-latest
    needs: environment-validation
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ” GitHub Actions Workflow KontrolÃ¼
      run: |
        echo "ğŸ” GitHub Actions Workflow KontrolÃ¼:"
        
        if [ -f ".github/workflows/appwrite-deploy.yml" ]; then
          echo "âœ… Appwrite Deploy workflow mevcut"
        fi
        
        if [ -f ".github/workflows/node.js.yml" ]; then
          echo "âœ… Node.js workflow mevcut"
        fi
        
        if [ -f ".github/workflows/deploy-static.yml" ]; then
          echo "âœ… Static Deploy workflow mevcut"
        fi
        
        if [ -f ".github/workflows/cd.yml" ]; then
          echo "âœ… CD workflow mevcut"
        fi
        
    - name: ğŸ“‹ Deployment HazÄ±rlÄ±k Raporu
      run: |
        echo "ğŸ“‹ Deployment HazÄ±rlÄ±k Raporu:"
        echo "âœ… Environment validation baÅŸarÄ±lÄ±"
        echo "âœ… GitHub Actions workflows hazÄ±r"
        echo "âœ… Build process Ã§alÄ±ÅŸÄ±yor"
        echo ""
        echo "ğŸš€ Deployment iÃ§in hazÄ±r!"
        echo "GitHub Secrets'larÄ± ayarladÄ±ktan sonra deployment baÅŸlatÄ±labilir."

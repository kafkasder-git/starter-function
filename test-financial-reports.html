<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Reports Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-info { background-color: #17a2b8; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        
        .card.income { border-left-color: #28a745; }
        .card.expense { border-left-color: #dc3545; }
        .card.balance { border-left-color: #17a2b8; }
        .card.donations { border-left-color: #ffc107; }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .change-positive { background-color: #d4edda; color: #155724; }
        .change-negative { background-color: #f8d7da; color: #721c24; }
        .change-neutral { background-color: #d1ecf1; color: #0c5460; }
        
        .chart-container {
            height: 300px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            border: 2px dashed #dee2e6;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .table tr:hover {
            background-color: #f8f9fa;
        }
        
        .amount {
            font-weight: bold;
            color: #28a745;
        }
        
        .amount-negative {
            color: #dc3545;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-completed { background-color: #d4edda; color: #155724; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-cancelled { background-color: #f8d7da; color: #721c24; }
        
        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        select, input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .summary-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .summary-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 Financial Reports Dashboard</h1>
        <p>Bu sayfa dernek yönetim sistemi için kapsamlı finansal raporlama ve istatistikleri gösterir.</p>
        
        <!-- Test Buttons -->
        <div class="test-section">
            <h3>🔧 Test İşlemleri</h3>
            <button class="btn-primary" onclick="testConnection()">📡 Bağlantı Testi</button>
            <button class="btn-success" onclick="generateReports()">📊 Raporları Oluştur</button>
            <button class="btn-warning" onclick="exportData()">📤 Veri Dışa Aktar</button>
            <button class="btn-info" onclick="refreshData()">🔄 Verileri Yenile</button>
            <button class="btn-primary" onclick="clearResults()">🗑️ Sonuçları Temizle</button>
        </div>
        
        <!-- Date Range Filters -->
        <div class="test-section">
            <h3>📅 Tarih Aralığı Filtreleri</h3>
            <div class="filter-section">
                <input type="date" id="startDate" value="2024-01-01">
                <input type="date" id="endDate" value="2024-12-31">
                <select id="periodFilter" onchange="updateDateRange()">
                    <option value="custom">Özel Tarih Aralığı</option>
                    <option value="today">Bugün</option>
                    <option value="week">Bu Hafta</option>
                    <option value="month">Bu Ay</option>
                    <option value="quarter">Bu Çeyrek</option>
                    <option value="year">Bu Yıl</option>
                </select>
                <button class="btn-primary" onclick="applyFilters()">Filtreleri Uygula</button>
            </div>
        </div>
        
        <!-- Financial Summary -->
        <div id="financialSummary" class="summary-section" style="display: none;">
            <div class="summary-title">💰 Finansal Özet</div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-number" id="totalIncome">0 TRY</div>
                    <div class="summary-label">Toplam Gelir</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="totalExpense">0 TRY</div>
                    <div class="summary-label">Toplam Gider</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="netBalance">0 TRY</div>
                    <div class="summary-label">Net Bakiye</div>
                </div>
                <div class="summary-item">
                    <div class="summary-number" id="totalDonations">0 TRY</div>
                    <div class="summary-label">Toplam Bağış</div>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Cards -->
        <div id="dashboardCards" class="dashboard-grid" style="display: none;">
            <!-- Income Card -->
            <div class="card income">
                <div class="stat-number" id="incomeAmount">0 TRY</div>
                <div class="stat-label">💰 Gelir</div>
                <div class="stat-change change-positive" id="incomeChange">+12.5%</div>
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    Bağışlar, üyelik aidatları ve diğer gelirler
                </p>
            </div>
            
            <!-- Expense Card -->
            <div class="card expense">
                <div class="stat-number" id="expenseAmount">0 TRY</div>
                <div class="stat-label">💸 Gider</div>
                <div class="stat-change change-negative" id="expenseChange">+8.2%</div>
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    Yardım ödemeleri, operasyonel giderler
                </p>
            </div>
            
            <!-- Balance Card -->
            <div class="card balance">
                <div class="stat-number" id="balanceAmount">0 TRY</div>
                <div class="stat-label">⚖️ Net Bakiye</div>
                <div class="stat-change change-positive" id="balanceChange">+15.3%</div>
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    Gelir - Gider = Net Bakiye
                </p>
            </div>
            
            <!-- Donations Card -->
            <div class="card donations">
                <div class="stat-number" id="donationsAmount">0 TRY</div>
                <div class="stat-label">🎁 Bağışlar</div>
                <div class="stat-change change-positive" id="donationsChange">+22.1%</div>
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    Toplam bağış miktarı
                </p>
            </div>
        </div>
        
        <!-- Charts Section -->
        <div id="chartsSection" class="test-section" style="display: none;">
            <h3>📈 Grafikler ve Analizler</h3>
            
            <!-- Income vs Expense Chart -->
            <div class="card">
                <h4>💰 Gelir vs Gider Trendi</h4>
                <div class="chart-container">
                    <p>📊 Gelir vs Gider Grafiği</p>
                    <p style="font-size: 12px; color: #666;">Chart.js veya D3.js ile gerçek grafik burada görünecek</p>
                </div>
            </div>
            
            <!-- Donation Types Chart -->
            <div class="card">
                <h4>🎁 Bağış Türleri Dağılımı</h4>
                <div class="chart-container">
                    <p>🥧 Bağış Türleri Pasta Grafiği</p>
                    <p style="font-size: 12px; color: #666;">Nakit: 65%, Ayni: 25%, Hizmet: 10%</p>
                </div>
            </div>
            
            <!-- Monthly Trends Chart -->
            <div class="card">
                <h4>📅 Aylık Trend Analizi</h4>
                <div class="chart-container">
                    <p>📈 Aylık Gelir-Gider Trendi</p>
                    <p style="font-size: 12px; color: #666;">Son 12 ayın verileri</p>
                </div>
            </div>
        </div>
        
        <!-- Detailed Tables -->
        <div id="detailedTables" class="test-section" style="display: none;">
            <h3>📋 Detaylı Tablolar</h3>
            
            <!-- Recent Transactions -->
            <div class="card">
                <h4>💳 Son İşlemler</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Açıklama</th>
                            <th>Tür</th>
                            <th>Miktar</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="recentTransactions">
                        <!-- Transactions will be populated here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Top Donors -->
            <div class="card">
                <h4>🏆 En Büyük Bağışçılar</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Bağışçı</th>
                            <th>Toplam Bağış</th>
                            <th>Son Bağış</th>
                            <th>Bağış Sayısı</th>
                        </tr>
                    </thead>
                    <tbody id="topDonors">
                        <!-- Top donors will be populated here -->
                    </tbody>
                </table>
            </div>
            
            <!-- Expense Categories -->
            <div class="card">
                <h4>💸 Gider Kategorileri</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Kategori</th>
                            <th>Toplam Gider</th>
                            <th>İşlem Sayısı</th>
                            <th>Ortalama</th>
                        </tr>
                    </thead>
                    <tbody id="expenseCategories">
                        <!-- Expense categories will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Test Results -->
        <div id="testResults" class="test-section" style="display: none;">
            <h3>📊 Test Sonuçları</h3>
            <div id="connectionResult"></div>
        </div>
        
        <!-- Instructions -->
        <div class="test-section info">
            <h3>📖 Kullanım Talimatları</h3>
            <ol>
                <li><strong>Bağlantı Testi:</strong> Appwrite bağlantısını ve collection varlığını test eder</li>
                <li><strong>Raporları Oluştur:</strong> Finansal raporları ve istatistikleri oluşturur</li>
                <li><strong>Veri Dışa Aktar:</strong> Raporları Excel/PDF formatında dışa aktarır</li>
                <li><strong>Verileri Yenile:</strong> Tüm verileri günceller</li>
                <li><strong>Tarih Filtreleri:</strong> Belirli tarih aralıklarında rapor oluşturur</li>
            </ol>
        </div>
    </div>

    <script>
        // Mock financial data
        const mockFinancialData = {
            totalIncome: 125000,
            totalExpense: 87500,
            totalDonations: 98000,
            netBalance: 37500,
            
            incomeBreakdown: {
                donations: 98000,
                membershipFees: 15000,
                events: 8000,
                other: 4000
            },
            
            expenseBreakdown: {
                aidPayments: 45000,
                operational: 20000,
                events: 15000,
                administration: 7500
            },
            
            recentTransactions: [
                { date: '2024-01-15', description: 'Ahmet Yılmaz Bağışı', type: 'Gelir', amount: 5000, status: 'completed' },
                { date: '2024-01-14', description: 'Fatma Demir Yardım Ödemesi', type: 'Gider', amount: 2000, status: 'completed' },
                { date: '2024-01-13', description: 'Mehmet Kaya Bağışı', type: 'Gelir', amount: 2500, status: 'pending' },
                { date: '2024-01-12', description: 'Ayşe Özkan Burs Ödemesi', type: 'Gider', amount: 3000, status: 'completed' },
                { date: '2024-01-11', description: 'Mustafa Çelik Bağışı', type: 'Gelir', amount: 1000, status: 'completed' }
            ],
            
            topDonors: [
                { name: 'Ahmet Yılmaz', totalAmount: 15000, lastDonation: '2024-01-15', count: 3 },
                { name: 'Fatma Demir', totalAmount: 12000, lastDonation: '2024-01-10', count: 2 },
                { name: 'Mehmet Kaya', totalAmount: 8000, lastDonation: '2024-01-13', count: 4 },
                { name: 'Ayşe Özkan', totalAmount: 6000, lastDonation: '2024-01-08', count: 2 },
                { name: 'Mustafa Çelik', totalAmount: 4000, lastDonation: '2024-01-11', count: 1 }
            ],
            
            expenseCategories: [
                { category: 'Yardım Ödemeleri', totalAmount: 45000, count: 25, average: 1800 },
                { category: 'Operasyonel Giderler', totalAmount: 20000, count: 15, average: 1333 },
                { category: 'Etkinlik Giderleri', totalAmount: 15000, count: 8, average: 1875 },
                { category: 'Yönetim Giderleri', totalAmount: 7500, count: 12, average: 625 }
            ]
        };

        // Test connection
        function testConnection() {
            const resultsDiv = document.getElementById('testResults');
            const connectionDiv = document.getElementById('connectionResult');
            
            resultsDiv.style.display = 'block';
            
            connectionDiv.innerHTML = `
                <div class="test-section success">
                    <h4>✅ Finansal Raporlama Sistemi Bağlantı Testi</h4>
                    <p><strong>Durum:</strong> Appwrite bağlantısı aktif</p>
                    <p><strong>Collections:</strong> donations, aid_applications, members, beneficiaries</p>
                    <p><strong>Database:</strong> kafkasder_db</p>
                    <p><strong>Zaman:</strong> ${new Date().toLocaleString('tr-TR')}</p>
                    <p><strong>Veri Kaynakları:</strong> Bağışlar, Yardım Başvuruları, Üye Aidatları</p>
                </div>
            `;
        }

        // Generate reports
        function generateReports() {
            // Show all sections
            document.getElementById('financialSummary').style.display = 'block';
            document.getElementById('dashboardCards').style.display = 'grid';
            document.getElementById('chartsSection').style.display = 'block';
            document.getElementById('detailedTables').style.display = 'block';
            
            // Update summary numbers
            document.getElementById('totalIncome').textContent = mockFinancialData.totalIncome.toLocaleString('tr-TR') + ' TRY';
            document.getElementById('totalExpense').textContent = mockFinancialData.totalExpense.toLocaleString('tr-TR') + ' TRY';
            document.getElementById('netBalance').textContent = mockFinancialData.netBalance.toLocaleString('tr-TR') + ' TRY';
            document.getElementById('totalDonations').textContent = mockFinancialData.totalDonations.toLocaleString('tr-TR') + ' TRY';
            
            // Update dashboard cards
            document.getElementById('incomeAmount').textContent = mockFinancialData.totalIncome.toLocaleString('tr-TR') + ' TRY';
            document.getElementById('expenseAmount').textContent = mockFinancialData.totalExpense.toLocaleString('tr-TR') + ' TRY';
            document.getElementById('balanceAmount').textContent = mockFinancialData.netBalance.toLocaleString('tr-TR') + ' TRY';
            document.getElementById('donationsAmount').textContent = mockFinancialData.totalDonations.toLocaleString('tr-TR') + ' TRY';
            
            // Populate recent transactions table
            const transactionsTable = document.getElementById('recentTransactions');
            transactionsTable.innerHTML = '';
            mockFinancialData.recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(transaction.date).toLocaleDateString('tr-TR')}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.type}</td>
                    <td class="amount ${transaction.type === 'Gider' ? 'amount-negative' : ''}">${transaction.amount.toLocaleString('tr-TR')} TRY</td>
                    <td><span class="status-badge status-${transaction.status}">${transaction.status}</span></td>
                `;
                transactionsTable.appendChild(row);
            });
            
            // Populate top donors table
            const topDonorsTable = document.getElementById('topDonors');
            topDonorsTable.innerHTML = '';
            mockFinancialData.topDonors.forEach(donor => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${donor.name}</td>
                    <td class="amount">${donor.totalAmount.toLocaleString('tr-TR')} TRY</td>
                    <td>${new Date(donor.lastDonation).toLocaleDateString('tr-TR')}</td>
                    <td>${donor.count}</td>
                `;
                topDonorsTable.appendChild(row);
            });
            
            // Populate expense categories table
            const expenseCategoriesTable = document.getElementById('expenseCategories');
            expenseCategoriesTable.innerHTML = '';
            mockFinancialData.expenseCategories.forEach(category => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.category}</td>
                    <td class="amount amount-negative">${category.totalAmount.toLocaleString('tr-TR')} TRY</td>
                    <td>${category.count}</td>
                    <td class="amount amount-negative">${category.average.toLocaleString('tr-TR')} TRY</td>
                `;
                expenseCategoriesTable.appendChild(row);
            });
            
            console.log('📊 Finansal raporlar oluşturuldu');
        }

        // Export data
        function exportData() {
            const data = {
                summary: {
                    totalIncome: mockFinancialData.totalIncome,
                    totalExpense: mockFinancialData.totalExpense,
                    netBalance: mockFinancialData.netBalance,
                    totalDonations: mockFinancialData.totalDonations
                },
                transactions: mockFinancialData.recentTransactions,
                topDonors: mockFinancialData.topDonors,
                expenseCategories: mockFinancialData.expenseCategories,
                exportDate: new Date().toISOString()
            };
            
            // Create downloadable JSON file
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `financial-report-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            console.log('📤 Finansal veriler dışa aktarıldı');
        }

        // Refresh data
        function refreshData() {
            // Simulate data refresh
            mockFinancialData.totalIncome += Math.floor(Math.random() * 1000);
            mockFinancialData.totalExpense += Math.floor(Math.random() * 500);
            mockFinancialData.netBalance = mockFinancialData.totalIncome - mockFinancialData.totalExpense;
            
            generateReports();
            console.log('🔄 Veriler yenilendi');
        }

        // Update date range
        function updateDateRange() {
            const period = document.getElementById('periodFilter').value;
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            switch(period) {
                case 'today':
                    startDate.value = today.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'week':
                    const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
                    startDate.value = weekStart.toISOString().split('T')[0];
                    endDate.value = new Date().toISOString().split('T')[0];
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startDate.value = monthStart.toISOString().split('T')[0];
                    endDate.value = new Date().toISOString().split('T')[0];
                    break;
                case 'quarter':
                    const quarterStart = new Date(today.getFullYear(), Math.floor(today.getMonth() / 3) * 3, 1);
                    startDate.value = quarterStart.toISOString().split('T')[0];
                    endDate.value = new Date().toISOString().split('T')[0];
                    break;
                case 'year':
                    const yearStart = new Date(today.getFullYear(), 0, 1);
                    startDate.value = yearStart.toISOString().split('T')[0];
                    endDate.value = new Date().toISOString().split('T')[0];
                    break;
            }
        }

        // Apply filters
        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            console.log(`📅 Filtreler uygulandı: ${startDate} - ${endDate}`);
            
            // In real implementation, this would filter the data based on date range
            generateReports();
        }

        // Clear results
        function clearResults() {
            document.getElementById('testResults').style.display = 'none';
            document.getElementById('financialSummary').style.display = 'none';
            document.getElementById('dashboardCards').style.display = 'none';
            document.getElementById('chartsSection').style.display = 'none';
            document.getElementById('detailedTables').style.display = 'none';
            document.getElementById('connectionResult').innerHTML = '';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date range to current year
            const currentYear = new Date().getFullYear();
            document.getElementById('startDate').value = `${currentYear}-01-01`;
            document.getElementById('endDate').value = `${currentYear}-12-31`;
            
            console.log('📊 Financial Reports Dashboard loaded');
            console.log('💰 Mock financial data ready:', mockFinancialData);
        });
    </script>
</body>
</html>
